FROM i2incommon/comanage-registry:3.3.1-20200930

ENV COMANAGE_REGISTRY_ADMIN_FAMILY_NAME=XXXXX
ENV COMANAGE_REGISTRY_ADMIN_USERNAME=XXXX
ENV COMANAGE_REGISTRY_DATASOURCE=Database/Mysql
ENV COMANAGE_REGISTRY_DATABASE=registry
ENV COMANAGE_REGISTRY_DATABASE_HOST=grouper_data
ENV COMANAGE_REGISTRY_DATABASE_USER=root
ENV COMANAGE_REGISTRY_DATABASE_USER_PASSWORD=
ENV COMANAGE_REGISTRY_EMAIL_FROM=xxxx@example.edu
ENV COMANAGE_REGISTRY_EMAIL_TRANSPORT=Smtp
ENV COMANAGE_REGISTRY_EMAIL_PORT=25
ENV COMANAGE_REGISTRY_EMAIL_HOST=smtp.example.edu
# COMANAGE_REGISTRY_SECURITY_SALT - autogenerated if not specified
# COMANAGE_REGISTRY_SECURITY_SEED - autogenerated if not specified
ENV HTTPS_CERT_FILE=/etc/pki/tls/certs/localhost.crt
ENV HTTPS_KEY_FILE=/etc/pki/tls/private/localhost.key
ENV MYSQL_ROOT_PASSWORD=xxxx
ENV MYSQL_DATABASE=registry
ENV MYSQL_USER=registry_user
ENV MYSQL_PASSWORD_FILE=xxxx
#ENV SHIBBOLETH_SP_CERT=/etc/shibboleth/sp-cert.pem
#ENV SHIBBOLETH_SP_PRIVKEY=/etc/shibboleth/sp-key.pem
#ENV SHIBBOLETH_SP_ENTITY_ID=comanage.example.edu
#ENV SHIBBOLETH_SP_METADATA_PROVIDER_XML=sdf
#ENV SHIBBOLETH_SP_SAMLDS_URL=thing

RUN yum -y update && yum -y install --setopt=tsflags=nodocs epel-release python-pip && pip install awscli && pip install --upgrade pip

ARG maintainer=my
ARG imagename=comanage
ARG version=3.3.1
ARG CSPHOSTNAME=localhost
ENV CSPHOSTNAME=$CSPHOSTNAME

LABEL Version=$version
ENV VERSION=$version

COPY container_files/shibboleth/idp-metadata.xml /etc/shibboleth/

COPY container_files/system/setservername.sh /usr/local/bin/
RUN chmod 755 /usr/local/bin/setservername.sh

#set hostname
RUN /usr/local/bin/setservername.sh


ENV LD_LIBRARY_PATH=/opt/shibboleth/lib64
